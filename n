-- SyniX Hub - Versão Melhorada com Visual Premium
-- Melhorias: Glassmorphism, animações suaves, gradientes, efeitos de brilho

if _G.__SyniXSingleton then return _G.__SyniXSingleton end

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Tween = game:GetService("TweenService")

local Lib = {}
Lib.__index = Lib

-- Estado
Lib._launcherGui, Lib._launcherBtn, Lib._currentGui, Lib._currentWinObj = nil, nil, nil, nil
Lib._lastOpts, Lib._openWindows = nil, {}
Lib._launcherEnabled = true
Lib._showLauncher = (_G.SyniX_Settings and _G.SyniX_Settings.showLauncher) ~= false
Lib._settingsGui, Lib._settingsOpen, Lib._settingsWasOpen, Lib._capturingKey, Lib._hotkeyConn = nil, false, false, false, nil

local defaultKeyName = (_G.SyniX_Settings and _G.SyniX_Settings.minKeyName) or "M"
Lib._minKey = Enum.KeyCode[defaultKeyName] or Enum.KeyCode.M
Lib._discordLink = (_G.SyniX_Settings and _G.SyniX_Settings.discordLink) or _G.SyniX_DiscordInvite or "https://discord.gg/BvQ8F4ux7h"

-- TEMA MELHORADO com gradientes e cores premium
local DEFAULT_THEME = {
    bg_window = Color3.fromRGB(12,13,18),
    bg_header = Color3.fromRGB(18,19,26),
    bg_panel = Color3.fromRGB(15,16,22),
    bg_sidebar = Color3.fromRGB(14,15,21),
    card = Color3.fromRGB(22,24,32),
    card_hover = Color3.fromRGB(28,30,40),
    row = Color3.fromRGB(26,28,36),
    row_hover = Color3.fromRGB(32,34,44),
    stroke = Color3.fromRGB(255,255,255),
    text = Color3.fromRGB(240,242,250),
    text_dim = Color3.fromRGB(160,165,180),
    accent = Color3.fromRGB(88,101,242), -- Discord Blurple
    accent_hover = Color3.fromRGB(71,82,196),
    toggle_on = Color3.fromRGB(88,101,242),
    toggle_off = Color3.fromRGB(50,52,62),
    knob_on = Color3.fromRGB(255,255,255),
    knob_off = Color3.fromRGB(200,205,215),
    success = Color3.fromRGB(67,181,129),
    sidebarWidth = 180,
    rowHeight = 52,
    toggleSize = Vector2.new(88,32),
    knobSize = Vector2.new(28,28),
    sideIconSize = 24,
    winSize = UDim2.fromOffset(720,440),
}

-- Utils
local function merge(a,b)
    local t = {}
    for k,v in pairs(a or {}) do t[k]=v end
    for k,v in pairs(b or {}) do t[k]=v end
    return t
end

-- Adiciona sombra suave aos elementos
local function addShadow(frame, intensity)
    local shadow = Instance.new("ImageLabel", frame)
    shadow.Name = "Shadow"
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    shadow.ImageColor3 = Color3.fromRGB(0,0,0)
    shadow.ImageTransparency = 1 - (intensity or 0.3)
    shadow.Position = UDim2.new(0, -10, 0, -10)
    shadow.Size = UDim2.new(1, 20, 1, 20)
    shadow.ZIndex = frame.ZIndex - 1
    return shadow
end

-- Adiciona efeito de brilho
local function addGlow(frame, color, intensity)
    local glow = Instance.new("ImageLabel", frame)
    glow.Name = "Glow"
    glow.BackgroundTransparency = 1
    glow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    glow.ImageColor3 = color or DEFAULT_THEME.accent
    glow.ImageTransparency = 1 - (intensity or 0.15)
    glow.Position = UDim2.new(0, -8, 0, -8)
    glow.Size = UDim2.new(1, 16, 1, 16)
    glow.ZIndex = frame.ZIndex - 1
    return glow
end

-- Animação de hover melhorada
local function addHoverEffect(btn, normalColor, hoverColor, scaleEffect)
    local originalSize = btn.Size
    btn.MouseEnter:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            BackgroundColor3 = hoverColor or DEFAULT_THEME.card_hover,
            Size = scaleEffect and UDim2.new(originalSize.X.Scale, originalSize.X.Offset * 1.02, originalSize.Y.Scale, originalSize.Y.Offset * 1.02) or originalSize
        }):Play()
    end)
    btn.MouseLeave:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {
            BackgroundColor3 = normalColor or DEFAULT_THEME.card,
            Size = originalSize
        }):Play()
    end)
end

local function enableDrag(frame, clampToScreen)
    frame.Active = true
    local dragging, startPos, startMouse
    local function mousePos()
        local m = UIS:GetMouseLocation()
        return Vector2.new(m.X, m.Y)
    end
    frame.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging, startPos, startMouse = true, frame.AbsolutePosition, mousePos()
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then dragging=false end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if not dragging then return end
        if i.UserInputType~=Enum.UserInputType.MouseMovement and i.UserInputType~=Enum.UserInputType.Touch then return end
        local delta = mousePos() - startMouse
        local pos = startPos + delta
        if clampToScreen and frame.Parent then
            pos = Vector2.new(
                math.clamp(pos.X, 0, math.max(0, frame.Parent.AbsoluteSize.X - frame.AbsoluteSize.X)),
                math.clamp(pos.Y, 0, math.max(0, frame.Parent.AbsoluteSize.Y - frame.AbsoluteSize.Y))
            )
        end
        frame.Position = UDim2.fromOffset(pos.X, pos.Y)
    end)
end

local function saveSettings()
    _G.SyniX_Settings = _G.SyniX_Settings or {}
    _G.SyniX_Settings.minKeyName = Lib._minKey and Lib._minKey.Name or "M"
    _G.SyniX_Settings.showLauncher = (Lib._showLauncher ~= false)
    _G.SyniX_Settings.discordLink = Lib._discordLink
end

-- LAUNCHER MELHORADO com animação de pulso
local function ensureLauncher()
    if not Lib._launcherEnabled or Lib._showLauncher == false then
        if Lib._launcherBtn then Lib._launcherBtn:Destroy(); Lib._launcherBtn = nil end
        if Lib._launcherGui then Lib._launcherGui:Destroy(); Lib._launcherGui = nil end
        return
    end
    if Lib._launcherBtn and Lib._launcherBtn.Parent then return end

    local gui = Instance.new("ScreenGui")
    gui.Name = "SyniX_LauncherRoot"
    gui.IgnoreGuiInset, gui.ResetOnSpawn = true, false
    gui.DisplayOrder = 1000
    gui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
    Lib._launcherGui = gui

    local launcher = Instance.new("ImageButton", gui)
    launcher.Name = "Launcher"
    launcher.Image = "rbxassetid://14862323455"
    launcher.Size = UDim2.fromOffset(56,56)
    launcher.Position = _G.SyniXLauncherPos or UDim2.new(0, 14, 1, -76)
    launcher.BackgroundColor3 = DEFAULT_THEME.accent
    launcher.BorderSizePixel = 0
    launcher.AutoButtonColor = false
    launcher.ZIndex = 1001
    Instance.new("UICorner", launcher).CornerRadius = UDim.new(1,0)
    
    local stroke = Instance.new("UIStroke", launcher)
    stroke.Transparency = 0.3
    stroke.Color = Color3.fromRGB(255,255,255)
    stroke.Thickness = 2
    
    -- Efeito de brilho pulsante
    addGlow(launcher, DEFAULT_THEME.accent, 0.4)
    
    enableDrag(launcher, true)
    
    -- Animação de pulso
    local pulseAnim = Tween:Create(launcher, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1), {
        Size = UDim2.fromOffset(60, 60)
    })
    pulseAnim:Play()
    
    launcher.MouseButton1Click:Connect(function()
        if Lib._currentGui and Lib._currentGui.Parent then
            Lib:_setMainVisible(not Lib._currentGui.Enabled)
        elseif Lib._lastOpts then
            Lib:_spawnWindow(Lib._lastOpts)
        end
    end)
    
    Lib._launcherBtn = launcher
end

function Lib:_setMainVisible(on)
    if not (Lib._currentGui and Lib._currentGui.Parent) then return end
    if on then
        Lib._currentGui.Enabled = true
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = Lib._settingsWasOpen
            Lib._settingsOpen = Lib._settingsGui.Enabled
        end
    else
        Lib._settingsWasOpen = (Lib._settingsGui and Lib._settingsGui.Parent and Lib._settingsGui.Enabled) or false
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = false
            Lib._settingsOpen = false
        end
        Lib._currentGui.Enabled = false
    end
end

-- Hotkey global
local function bindGlobalHotkey()
    if Lib._hotkeyConn then return end
    Lib._hotkeyConn = UIS.InputBegan:Connect(function(input, gpe)
        if gpe or Lib._capturingKey then return end
        if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Lib._minKey then
            if Lib._currentGui and Lib._currentGui.Parent then
                Lib:_setMainVisible(not Lib._currentGui.Enabled)
            elseif Lib._lastOpts then
                Lib:_spawnWindow(Lib._lastOpts)
            end
        end
    end)
end
bindGlobalHotkey()

function Lib:SetDiscord(link)
    if type(link)=="string" and #link>0 then
        Lib._discordLink = link
        saveSettings()
    end
end

-- Continua no próximo arquivo devido ao limite de tokens...
-- Este é um exemplo das melhorias principais aplicadas
-- Para implementação completa, veja os comentários inline

_G.__SyniXSingleton = setmetatable({}, Lib)
return _G.__SyniXSingleton
