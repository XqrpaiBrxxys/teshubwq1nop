-- SyniX Hub - VERSÃO PREMIUM COM MELHORIAS VISUAIS
-- Todas as funções originais mantidas + melhorias de design
-- Melhorias: Cores premium, animações suaves, efeitos hover, mobile otimizado

if _G.__SyniXSingleton then return _G.__SyniXSingleton end

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Tween = game:GetService("TweenService")

local Lib = {}
Lib.__index = Lib

-- Estado (mantido igual)
Lib._launcherGui = nil
Lib._launcherBtn = nil
Lib._currentGui = nil
Lib._currentWinObj = nil
Lib._lastOpts = nil
Lib._openWindows = {}
Lib._launcherEnabled = true
Lib._showLauncher = (_G.SyniX_Settings and _G.SyniX_Settings.showLauncher) ~= false
Lib._settingsGui = nil
Lib._settingsOpen = false
Lib._settingsWasOpen = false
Lib._capturingKey = false
Lib._hotkeyConn = nil

local defaultKeyName = (_G.SyniX_Settings and _G.SyniX_Settings.minKeyName) or "M"
Lib._minKey = Enum.KeyCode[defaultKeyName] or Enum.KeyCode.M
Lib._discordLink = (_G.SyniX_Settings and _G.SyniX_Settings.discordLink) or _G.SyniX_DiscordInvite or "https://discord.gg/BvQ8F4ux7h"

-- ===== TEMA MELHORADO =====
local DEFAULT_THEME = {
    -- Cores mais escuras e modernas
    bg_window   = Color3.fromRGB(12,13,18),
    bg_header   = Color3.fromRGB(18,19,26),
    bg_panel    = Color3.fromRGB(15,16,22),
    bg_sidebar  = Color3.fromRGB(14,15,21),
    card        = Color3.fromRGB(22,24,32),
    card_hover  = Color3.fromRGB(28,30,40),
    row         = Color3.fromRGB(26,28,36),
    row_hover   = Color3.fromRGB(32,34,44),
    stroke      = Color3.fromRGB(255,255,255),
    text        = Color3.fromRGB(240,242,250),
    text_dim    = Color3.fromRGB(160,165,180),
    -- Cor de destaque premium (Discord Blurple)
    accent      = Color3.fromRGB(88,101,242),
    accent_hover= Color3.fromRGB(71,82,196),
    toggle_on   = Color3.fromRGB(88,101,242),
    toggle_off  = Color3.fromRGB(50,52,62),
    knob_on     = Color3.fromRGB(255,255,255),
    knob_off    = Color3.fromRGB(200,205,215),
    success     = Color3.fromRGB(67,181,129),
    -- Tamanhos otimizados para mobile
    sidebarWidth = 180,
    rowHeight    = 52,
    toggleSize   = Vector2.new(88,32),
    knobSize     = Vector2.new(28,28),
    sideIconSize = 24,
    winSize      = UDim2.fromOffset(720,440),
}

-- ===== Utils (mantidos) =====
local function merge(a,b)
    local t = {}
    for k,v in pairs(a or {}) do t[k]=v end
    for k,v in pairs(b or {}) do t[k]=v end
    return t
end

-- NOVO: Adiciona efeito hover suave
local function addHoverEffect(btn, normalColor, hoverColor)
    btn.MouseEnter:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = hoverColor or DEFAULT_THEME.card_hover
        }):Play()
    end)
    btn.MouseLeave:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = normalColor or DEFAULT_THEME.card
        }):Play()
    end)
end

local function enableDrag(frame, clampToScreen)
    frame.Active = true
    local dragging, startPos, startMouse
    local function mousePos()
        local m = UIS:GetMouseLocation()
        return Vector2.new(m.X, m.Y)
    end
    frame.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging, startPos, startMouse = true, frame.AbsolutePosition, mousePos()
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then dragging=false end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if not dragging then return end
        if i.UserInputType~=Enum.UserInputType.MouseMovement and i.UserInputType~=Enum.UserInputType.Touch then return end
        local delta = mousePos() - startMouse
        local pos = startPos + delta
        if clampToScreen and frame.Parent then
            pos = Vector2.new(
                math.clamp(pos.X, 0, math.max(0, frame.Parent.AbsoluteSize.X - frame.AbsoluteSize.X)),
                math.clamp(pos.Y, 0, math.max(0, frame.Parent.AbsoluteSize.Y - frame.AbsoluteSize.Y))
            )
        end
        frame.Position = UDim2.fromOffset(pos.X, pos.Y)
    end)
end

local function enableLauncherDrag(btn)
    btn.Active = true
    local dragging = false
    local function getMouse()
        local m = UIS:GetMouseLocation()
        return Vector2.new(m.X, m.Y)
    end
    btn.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging = true
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then
                    dragging = false
                    _G.SyniXLauncherPos = btn.Position
                end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if not dragging then return end
        if i.UserInputType~=Enum.UserInputType.MouseMovement and i.UserInputType~=Enum.UserInputType.Touch then return end
        local m = getMouse()
        local w,h = btn.AbsoluteSize.X, btn.AbsoluteSize.Y
        local px, py = m.X - w/2, m.Y - h/2
        if btn.Parent then
            local sz = btn.Parent.AbsoluteSize
            px = math.clamp(px, 0, math.max(0, sz.X - w))
            py = math.clamp(py, 0, math.max(0, sz.Y - h))
        end
        btn.Position = UDim2.fromOffset(px, py)
    end)
end

local function saveSettings()
    _G.SyniX_Settings = _G.SyniX_Settings or {}
    _G.SyniX_Settings.minKeyName = Lib._minKey and Lib._minKey.Name or "M"
    _G.SyniX_Settings.showLauncher = (Lib._showLauncher ~= false)
    _G.SyniX_Settings.discordLink = Lib._discordLink
end

-- ===== Launcher MELHORADO =====
local function ensureLauncher()
    if not Lib._launcherEnabled then return end
    if Lib._showLauncher == false then
        if Lib._launcherBtn and Lib._launcherBtn.Parent then Lib._launcherBtn:Destroy() end
        Lib._launcherBtn = nil
        if Lib._launcherGui and Lib._launcherGui.Parent then Lib._launcherGui:Destroy() end
        Lib._launcherGui = nil
        return
    end
    if Lib._launcherBtn and Lib._launcherBtn.Parent then return end

    local player = Players.LocalPlayer
    local gui = Lib._launcherGui
    if not gui or not gui.Parent then
        gui = Instance.new("ScreenGui")
        gui.Name = "SyniX_LauncherRoot"
        gui.IgnoreGuiInset, gui.ResetOnSpawn = true, false
        gui.DisplayOrder = 1000
        gui.Parent = player:WaitForChild("PlayerGui")
        Lib._launcherGui = gui
    end

    local launcher = Instance.new("ImageButton")
    launcher.Name = "Launcher"
    launcher.Image = "rbxassetid://14862323455"
    launcher.Size = UDim2.fromOffset(56,56) -- Maior para mobile
    launcher.Position = _G.SyniXLauncherPos or UDim2.new(0, 14, 1, -76)
    launcher.BackgroundColor3 = DEFAULT_THEME.accent -- Cor premium
    launcher.BorderSizePixel = 0
    launcher.AutoButtonColor = false
    launcher.ZIndex = 1001
    Instance.new("UICorner", launcher).CornerRadius = UDim.new(1,0)
    
    local s = Instance.new("UIStroke", launcher)
    s.Transparency = 0.3
    s.Color = Color3.fromRGB(255,255,255)
    s.Thickness = 2
    launcher.Parent = gui

    enableLauncherDrag(launcher)
    
    -- Animação de pulso suave
    spawn(function()
        while launcher.Parent do
            Tween:Create(launcher, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Size = UDim2.fromOffset(60, 60)
            }):Play()
            wait(1.5)
            Tween:Create(launcher, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Size = UDim2.fromOffset(56, 56)
            }):Play()
            wait(1.5)
        end
    end)

    launcher.MouseButton1Click:Connect(function()
        if Lib._currentGui and Lib._currentGui.Parent then
            local newState = not Lib._currentGui.Enabled
            Lib:_setMainVisible(newState)
        elseif Lib._lastOpts then
            Lib:_spawnWindow(Lib._lastOpts)
        end
    end)

    Lib._launcherBtn = launcher
end

local function destroyLauncher()
    if Lib._launcherBtn and Lib._launcherBtn.Parent then Lib._launcherBtn:Destroy() end
    Lib._launcherBtn = nil
    if Lib._launcherGui and Lib._launcherGui.Parent then Lib._launcherGui:Destroy() end
    Lib._launcherGui = nil
end

function Lib:_setMainVisible(on)
    if not (Lib._currentGui and Lib._currentGui.Parent) then return end
    if on then
        Lib._currentGui.Enabled = true
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = (Lib._settingsWasOpen == true)
            Lib._settingsOpen = Lib._settingsGui.Enabled
        end
    else
        Lib._settingsWasOpen = (Lib._settingsGui and Lib._settingsGui.Parent and Lib._settingsGui.Enabled) or false
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = false
            Lib._settingsOpen = false
        end
        Lib._currentGui.Enabled = false
    end
end

local function bindGlobalHotkey()
    if Lib._hotkeyConn then return end
    Lib._hotkeyConn = UIS.InputBegan:Connect(function(input, gpe)
        if gpe or Lib._capturingKey then return end
        if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Lib._minKey then
            if Lib._currentGui and Lib._currentGui.Parent then
                Lib:_setMainVisible(not Lib._currentGui.Enabled)
            elseif Lib._lastOpts then
                Lib:_spawnWindow(Lib._lastOpts)
            end
        end
    end)
end
bindGlobalHotkey()

function Lib:SetDiscord(link)
    if type(link)=="string" and #link>0 then
        Lib._discordLink = link
        saveSettings()
    end
end

local function CopyDiscordLink()
    local link = (Lib._discordLink and tostring(Lib._discordLink)) or ""
    if link ~= "" and setclipboard then
        pcall(setclipboard, link)
    end
end

-- Continua na próxima mensagem (código muito grande)
