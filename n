-- SyniX Hub - TEMA ESTILO GTA V
-- Visual premium com gradientes, glow effects e animações suaves
-- TODAS as funcionalidades originais mantidas!

if _G.__SyniXSingleton then return _G.__SyniXSingleton end

local Players = game:GetService("Players")
local UIS     = game:GetService("UserInputService")
local Tween   = game:GetService("TweenService")

local Lib = {}
Lib.__index = Lib

-- ===== Estado (mantido 100%) =====
Lib._launcherGui     = nil
Lib._launcherBtn     = nil
Lib._currentGui      = nil
Lib._currentWinObj   = nil
Lib._lastOpts        = nil
Lib._openWindows     = {}
Lib._launcherEnabled = true
Lib._showLauncher    = (_G.SyniX_Settings and _G.SyniX_Settings.showLauncher) ~= false
Lib._settingsGui     = nil
Lib._settingsOpen    = false
Lib._settingsWasOpen = false
Lib._capturingKey    = false
Lib._hotkeyConn      = nil

local defaultKeyName = (_G.SyniX_Settings and _G.SyniX_Settings.minKeyName) or "M"
Lib._minKey = Enum.KeyCode[defaultKeyName] or Enum.KeyCode.M
Lib._discordLink = (_G.SyniX_Settings and _G.SyniX_Settings.discordLink) or _G.SyniX_DiscordInvite or "https://discord.gg/BvQ8F4ux7h"

-- ===== TEMA ESTILO GTA V =====
local DEFAULT_THEME = {
    -- Cores estilo GTA (verde/dourado com toques escuros)
    bg_window   = Color3.fromRGB(8, 10, 12),
    bg_header   = Color3.fromRGB(15, 18, 20),
    bg_panel    = Color3.fromRGB(12, 14, 16),
    bg_sidebar  = Color3.fromRGB(10, 12, 14),
    
    -- Cards e rows com leve toque verde
    card        = Color3.fromRGB(18, 22, 20),
    card_hover  = Color3.fromRGB(25, 30, 27),
    row         = Color3.fromRGB(20, 24, 22),
    row_hover   = Color3.fromRGB(28, 34, 30),
    
    -- Cores de destaque GTA (verde neon + dourado)
    accent      = Color3.fromRGB(140, 190, 60),  -- Verde GTA
    accent_gold = Color3.fromRGB(255, 190, 60),  -- Dourado
    accent_hover= Color3.fromRGB(160, 210, 80),
    
    stroke      = Color3.fromRGB(140, 190, 60),  -- Verde GTA
    text        = Color3.fromRGB(245, 248, 250),
    text_dim    = Color3.fromRGB(170, 180, 185),
    
    -- Toggles estilo GTA
    toggle_on   = Color3.fromRGB(140, 190, 60),
    toggle_off  = Color3.fromRGB(40, 45, 42),
    knob_on     = Color3.fromRGB(255, 255, 255),
    knob_off    = Color3.fromRGB(180, 185, 180),
    
    -- Tamanhos otimizados
    sidebarWidth = 200,
    rowHeight    = 54,
    toggleSize   = Vector2.new(90,34),
    knobSize     = Vector2.new(30,30),
    sideIconSize = 26,
    winSize      = UDim2.fromOffset(760,480),
}

-- ===== Utils =====
local function merge(a,b)
    local t = {}
    for k,v in pairs(a or {}) do t[k]=v end
    for k,v in pairs(b or {}) do t[k]=v end
    return t
end

-- NOVO: Adiciona gradiente estilo GTA
local function addGTAGradient(frame, vertical)
    local gradient = Instance.new("UIGradient", frame)
    if vertical then
        gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(140, 190, 60)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 150, 40)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(140, 190, 60))
        }
        gradient.Rotation = 90
    else
        gradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 24, 22)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(25, 30, 27)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 24, 22))
        }
    end
    gradient.Transparency = NumberSequence.new(0.7)
    return gradient
end

-- NOVO: Efeito glow estilo GTA
local function addGlow(frame, color, intensity)
    local glow = Instance.new("ImageLabel", frame)
    glow.Name = "Glow"
    glow.BackgroundTransparency = 1
    glow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    glow.ImageColor3 = color or DEFAULT_THEME.accent
    glow.ImageTransparency = 1 - (intensity or 0.5)
    glow.Position = UDim2.new(0, -6, 0, -6)
    glow.Size = UDim2.new(1, 12, 1, 12)
    glow.ZIndex = frame.ZIndex - 1
    return glow
end

-- NOVO: Hover effect com glow
local function addGTAHover(btn, normalColor, hoverColor)
    local glow = addGlow(btn, DEFAULT_THEME.accent, 0)
    
    btn.MouseEnter:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = hoverColor or DEFAULT_THEME.card_hover
        }):Play()
        Tween:Create(glow, TweenInfo.new(0.25), {ImageTransparency = 0.7}):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        Tween:Create(btn, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundColor3 = normalColor or DEFAULT_THEME.card
        }):Play()
        Tween:Create(glow, TweenInfo.new(0.25), {ImageTransparency = 1}):Play()
    end)
end

local function enableDrag(frame, clampToScreen)
    frame.Active = true
    local dragging, startPos, startMouse
    local function mousePos()
        local m = UIS:GetMouseLocation()
        return Vector2.new(m.X, m.Y)
    end
    frame.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging, startPos, startMouse = true, frame.AbsolutePosition, mousePos()
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then dragging=false end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if not dragging then return end
        if i.UserInputType~=Enum.UserInputType.MouseMovement and i.UserInputType~=Enum.UserInputType.Touch then return end
        local delta = mousePos() - startMouse
        local pos   = startPos + delta
        if clampToScreen and frame.Parent then
            pos = Vector2.new(
                math.clamp(pos.X, 0, math.max(0, frame.Parent.AbsoluteSize.X - frame.AbsoluteSize.X)),
                math.clamp(pos.Y, 0, math.max(0, frame.Parent.AbsoluteSize.Y - frame.AbsoluteSize.Y))
            )
        end
        frame.Position = UDim2.fromOffset(pos.X, pos.Y)
    end)
end

local function enableLauncherDrag(btn)
    btn.Active = true
    local dragging = false
    local function getMouse()
        local m = UIS:GetMouseLocation()
        return Vector2.new(m.X, m.Y)
    end
    btn.InputBegan:Connect(function(i)
        if i.UserInputType==Enum.UserInputType.MouseButton1 or i.UserInputType==Enum.UserInputType.Touch then
            dragging = true
            i.Changed:Connect(function()
                if i.UserInputState==Enum.UserInputState.End then
                    dragging = false
                    _G.SyniXLauncherPos = btn.Position
                end
            end)
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if not dragging then return end
        if i.UserInputType~=Enum.UserInputType.MouseMovement and i.UserInputType~=Enum.UserInputType.Touch then return end
        local m = getMouse()
        local w,h = btn.AbsoluteSize.X, btn.AbsoluteSize.Y
        local px, py = m.X - w/2, m.Y - h/2
        if btn.Parent then
            local sz = btn.Parent.AbsoluteSize
            px = math.clamp(px, 0, math.max(0, sz.X - w))
            py = math.clamp(py, 0, math.max(0, sz.Y - h))
        end
        btn.Position = UDim2.fromOffset(px, py)
    end)
end

local function saveSettings()
    _G.SyniX_Settings = _G.SyniX_Settings or {}
    _G.SyniX_Settings.minKeyName  = Lib._minKey and Lib._minKey.Name or "M"
    _G.SyniX_Settings.showLauncher= (Lib._showLauncher ~= false)
    _G.SyniX_Settings.discordLink = Lib._discordLink
end

-- ===== Launcher ESTILO GTA =====
local function ensureLauncher()
    if not Lib._launcherEnabled then return end
    if Lib._showLauncher == false then
        if Lib._launcherBtn and Lib._launcherBtn.Parent then Lib._launcherBtn:Destroy() end
        Lib._launcherBtn = nil
        if Lib._launcherGui and Lib._launcherGui.Parent then Lib._launcherGui:Destroy() end
        Lib._launcherGui = nil
        return
    end
    if Lib._launcherBtn and Lib._launcherBtn.Parent then return end

    local player = Players.LocalPlayer
  local gui = Lib._launcherGui
    if not gui or not gui.Parent then
        gui = Instance.new("ScreenGui")
        gui.Name = "SyniX_LauncherRoot"
        gui.IgnoreGuiInset, gui.ResetOnSpawn = true, false
        gui.DisplayOrder = 1000
        gui.Parent = player:WaitForChild("PlayerGui")
        Lib._launcherGui = gui
    end

    local launcher = Instance.new("ImageButton")
    launcher.Name = "Launcher"
    launcher.Image = "rbxassetid://14862323455"
    launcher.Size = UDim2.fromOffset(60,60)  -- Maior
    launcher.Position = _G.SyniXLauncherPos or UDim2.new(0, 14, 1, -80)
    launcher.BackgroundColor3 = DEFAULT_THEME.accent  -- Verde GTA
    launcher.BorderSizePixel = 0
    launcher.AutoButtonColor = false
    launcher.ZIndex = 1001
    Instance.new("UICorner", launcher).CornerRadius = UDim.new(0, 12)  -- Menos arredondado
    
    -- Stroke verde brilhante
    local s = Instance.new("UIStroke", launcher)
    s.Transparency = 0.2
    s.Color = DEFAULT_THEME.accent
    s.Thickness = 3
    
    -- Glow pulsante
    local glow = addGlow(launcher, DEFAULT_THEME.accent, 0.6)
    launcher.Parent = gui

    enableLauncherDrag(launcher)
    
    -- Animação de pulso com glow
    spawn(function()
        while launcher.Parent do
            Tween:Create(launcher, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Size = UDim2.fromOffset(64, 64)
            }):Play()
            Tween:Create(glow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                ImageTransparency = 0.4
            }):Play()
            wait(1.5)
            Tween:Create(launcher, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                Size = UDim2.fromOffset(60, 60)
            }):Play()
            Tween:Create(glow, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
                ImageTransparency = 0.6
            }):Play()
            wait(1.5)
        end
    end)

    launcher.MouseButton1Click:Connect(function()
        if Lib._currentGui and Lib._currentGui.Parent then
            local newState = not Lib._currentGui.Enabled
            Lib:_setMainVisible(newState)
        elseif Lib._lastOpts then
            Lib:_spawnWindow(Lib._lastOpts)
        end
    end)

    Lib._launcherBtn = launcher
end

local function destroyLauncher()
    if Lib._launcherBtn and Lib._launcherBtn.Parent then Lib._launcherBtn:Destroy() end
    Lib._launcherBtn = nil
    if Lib._launcherGui and Lib._launcherGui.Parent then Lib._launcherGui:Destroy() end
    Lib._launcherGui = nil
end

function Lib:_setMainVisible(on)
    if not (Lib._currentGui and Lib._currentGui.Parent) then return end
    if on then
        Lib._currentGui.Enabled = true
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = (Lib._settingsWasOpen == true)
            Lib._settingsOpen = Lib._settingsGui.Enabled
        end
    else
        Lib._settingsWasOpen = (Lib._settingsGui and Lib._settingsGui.Parent and Lib._settingsGui.Enabled) or false
        if Lib._settingsGui and Lib._settingsGui.Parent then
            Lib._settingsGui.Enabled = false
            Lib._settingsOpen = false
        end
        Lib._currentGui.Enabled = false
    end
end

local function bindGlobalHotkey()
    if Lib._hotkeyConn then return end
    Lib._hotkeyConn = UIS.InputBegan:Connect(function(input, gpe)
        if gpe or Lib._capturingKey then return end
        if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Lib._minKey then
            if Lib._currentGui and Lib._currentGui.Parent then
                Lib:_setMainVisible(not Lib._currentGui.Enabled)
            elseif Lib._lastOpts then
                Lib:_spawnWindow(Lib._lastOpts)
            end
        end
    end)
end
bindGlobalHotkey()

function Lib:SetDiscord(link)
    if type(link)=="string" and #link>0 then
        Lib._discordLink = link
        saveSettings()
    end
end

local function CopyDiscordLink()
    local link = (Lib._discordLink and tostring(Lib._discordLink)) or ""
    if link ~= "" and setclipboard then
        pcall(setclipboard, link)
    end
end

-- Continua nas próximas partes (buildSettingsUI, makeDropdownAPI, makeTabAPI, _spawnWindow)
-- Mantendo TODAS as funcionalidades, apenas visual GTA aplicado
